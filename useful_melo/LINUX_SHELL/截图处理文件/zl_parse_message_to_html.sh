#!/bin/sh
head='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>12580 日志查询平台 » 日志查询结果</title><style type="text/css">.ui-widget-header{    border: 1px solid #aed0ea;    background: #deedf7 url(images/ui-bg_highlight-soft_100_deedf7_1x100.png) 50% 50% repeat-x;    color: #222222;    font-weight: bold;}    h4 {    font-size: 18px;    line-height: 20px;    margin-bottom: 10px;}.btn {    display: inline-block;    padding: 4px 14px;    margin-bottom: 0;    font-size: 14px;    line-height: 20px;    color: #333333;    text-align: center;    text-shadow: 0 1px 1px rgba(255, 255, 255, 0.75);        cursor: pointer;    background-color: #f5f5f5;    background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#ffffff), to(#e6e6e6));    background-image: -webkit-linear-gradient(top, #ffffff, #e6e6e6);    background-image: -o-linear-gradient(top, #ffffff, #e6e6e6);    background-image: linear-gradient(to bottom, #ffffff, #e6e6e6);    background-image: -moz-linear-gradient(top, #ffffff, #e6e6e6);    background-repeat: repeat-x;    border: 1px solid #bbbbbb;    border-color: rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.25);    border-color: #e6e6e6 #e6e6e6 #bfbfbf;    border-bottom-color: #a2a2a2;    -webkit-border-radius: 4px;    -moz-border-radius: 4px;    border-radius: 4px;    filter: progid:dximagetransform.microsoft.gradient(startColorstr='#ffffffff', endColorstr='#ffe6e6e6', GradientType=0);    filter: progid:dximagetransform.microsoft.gradient(enabled=false);    -webkit-box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 1px 2px rgba(0, 0, 0, 0.05);    -moz-box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 1px 2px rgba(0, 0, 0, 0.05);    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 1px 2px rgba(0, 0, 0, 0.05);}.ui-widget-content a {    color: #362b36;}.table-bordered {    border: 1px solid #dddddd;    border-collapse: separate;    border-left: 0;    -webkit-border-radius: 4px;    -moz-border-radius: 4px;    border-radius: 4px;}.ui-widget-content {    border: 1px solid #dddddd;    background: #f2f5f7 url(images/ui-bg_highlight-hard_100_f2f5f7_1x100.png) 50% top repeat-x;    background-image: url(images/ui-bg_highlight-hard_100_f2f5f7_1x100.png);    background-position-x: 50%;    background-position-y: top;    background-size: initial;    background-repeat-x: repeat;    background-repeat-y: no-repeat;    background-attachment: initial;    background-origin: initial;    background-clip: initial;    background-color: rgb(242, 245, 247);    color: #362b36;}.table th, .table td {    padding: 8px;    line-height: 20px;    text-align: left;    vertical-align: top;    border-top: 1px solid #dddddd;}.table {    width: 100%;    margin-bottom: 20px;    margin-top: 5px;}table {    max-width: 100%;    background-color: transparent;    border-collapse: collapse;    border-spacing: 0;}td{    margin: 0;    padding: 0;    border: 0;    font-weight: inherit;    font-style: inherit;    font-size: 100%;    font-family: inherit;    vertical-align: baseline;}body, table, input, textarea {    font-family: Lucida,"Lucida Grande","Microsoft Yahei",Tahoma,Arial,Helvetica,sans-serif;    font-size: 12px;    color: #362b36;}body{padding: 0px;margin: 0px;}.table-bordered td {    border-left: 1px solid #dddddd;}</style></head><body><div id="body" class="navbar"><div id="content" class="ui-tabs-panel ui-widget-content container-fluid"><table id="log-grid" class="vuvuzela main font12" style="background-color: rgb(242, 245, 247);" cellspacing="0" cellpadding="0"><tbody><tr><td id="result_td"><table cellpadding="2" cellspacing="2" class="table table-bordered result_table"><caption><div style="float: left"><h4>短信下行</h4></div><div><a class="btn" style="float:right;" href="http://luwakweb.12580.com:8004/logs/export?tag=cmpp&amp;phones=18948774848,18938023500,18978982671,18888367756,18899495988,18888368032,18946060202,18899810168,18970361082,18899490599,18899891481,18888650485,18888367721,18899817858,18891846358&amp;start=20170101&amp;end=20170103">导出</a></div><div style="clear:both;"></div></caption><tbody><tr><th class="ui-widget-header">下行时间</th><th class="ui-widget-header">移动串号</th><th class="ui-widget-header">发送号码</th><th class="ui-widget-header">下行手机号</th><th class="ui-widget-header">Appcode</th><th class="ui-widget-header">计费代码</th><th class="ui-widget-header">提交结果</th><th class="ui-widget-header">短信内容</th><th class="ui-widget-header">移动串号</th><th class="ui-widget-header">接收状态</th><th class="ui-widget-header">下行手机号</th><th class="ui-widget-header">提交至移动网关时间</th><th class="ui-widget-header">移动网关处理完成时间</th></tr>'
end='</tbody></table></td></tr></tbody></table></div></div></body></html>'
IFS_old=$IFS
IFS=$'\n'
for file in `ls *.txt`
do
	i=`expr index $file '.'`
	i=`expr $i - 1`
	file_name=${file:0:$i}
    html_content=''
    echo $file
    # echo `cat $file`
    for line in `cat $file`
    do
    	# echo $line
    	tr_content=`echo $line |awk -F ",;" '{printf "<tr><td>%s</td><td>%s</td><td>%s</td><td>%s</td><td>%s</td><td>%s</td><td>%s</td><td>%s</td><td>%s</td><td>%s</td><td>%s</td><td>%s</td><td>%s</td></tr>\n",$1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12,$13}'`
    	html_content=$html_content$tr_content
    done
    html_content=$head$html_content$end
    echo $html_content > $file_name".html"
done
IFS=$IFS_old